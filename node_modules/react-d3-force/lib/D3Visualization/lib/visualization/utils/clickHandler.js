'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = clickHandler;

var _d = require('d3');

var _d2 = _interopRequireDefault(_d);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function clickHandler() {
  var cc = function cc(selection) {
    // euclidean distance
    var dist = function dist(a, b) {
      return Math.sqrt(Math.pow(a[0] - b[0], 2), Math.pow(a[1] - b[1], 2));
    };
    var down = void 0;
    var tolerance = 5;
    var wait = null;
    selection.on('mousedown', function () {
      _d2.default.event.target.__data__.fixed = true;
      down = _d2.default.mouse(document.body);
      return _d2.default.event.stopPropagation();
    });

    return selection.on('mouseup', function () {
      if (dist(down, _d2.default.mouse(document.body)) > tolerance) {} else {
        if (wait) {
          window.clearTimeout(wait);
          wait = null;
          return event.dblclick(_d2.default.event.target.__data__);
        } else {
          event.click(_d2.default.event.target.__data__);
          return wait = window.setTimeout(function (e) {
            return function () {
              return wait = null;
            };
          }(_d2.default.event), 250);
        }
      }
    });
  };

  var event = _d2.default.dispatch('click', 'dblclick');
  return _d2.default.rebind(cc, event, 'on');
}